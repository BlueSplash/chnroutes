#summary 使用方法
#labels Featured
= 介绍 =
这几个脚本主要利用来自 [http://ftp.apnic.net/apnic/dbase/data/country-ipv4.lst] 的数据生成路由命令脚本, 让vpn客户端在进行连接的时候自动执行. 通过这些路由脚本, 可以让用户在使用vpn作为默认网络网关的时候, 不使用vpn进行对中国国内ip的访问, 从而减轻vpn的负担, 和增加访问国内网站的速度.

= 基本约定 =

在使用这些脚本之前, 请确保你在自己的电脑上已经成功配置好一个vpn连接(pptp 或者 openvpn), 并且让之以默认网络网关的方式运行, 这通常也是默认配置, 即vpn接入之后所有网络流量都通过vpn进行.

= Mac OSX =
===openvpn===
(这里假定用户使用Tunnelblick作为openvpn客户端)
  # 下载 chnroutes_ovpn_mac
  # 从终端进入下载目录, 执行`python chnroutes_ovpn_mac`, 执行完毕之后同一目录下将生成两个新文件'vpnup'和'vpndown'
  # 在终端里运行命令 `chmod a+x vpnup vpndown` 把这两个文件设置为可执行
  # 把这两个文件copy到openvpn的配置目录并修过openvpn配置文件, 在末尾加上两句:
    {{{
    up vpnup
    down vpndown
    }}}
  # 设置完毕, 重连openvpn. 你可以通过`netstat -nr`命令的输出来确认vpnup/vpndown 是否正确执行. 在连接之后, 使用上述命令, 如果能看到大量的输出则表明路由表已经被成功设置, 断开连接之后, 再执该命令则可以看到断开前的那些输出已经消失.

进一步的测试, 你可以使用 route 命令进行, 如执行 `route get 8.8.8.8`, 这里8.8.8.8是google dns的ip, 位置在国外. 你可以看到在输出结果的gateway字段与vpn的网关一致; 再尝试`route get 202.96.134.133` 这里202.96.134.133是一个国内的ip, 这时候输出结果的gateway将变成与没连接vpn之前的网关.


*需要注意的是, 在Tunnelblick上不能选取Set nameserver选项, 否则这两个脚本将不能被调用*

===pptp===
  # 下载 chnroutes_pptp_mac
  # 从终端进入下载目录, 执行`python chnroutes_pptp_mac`, 执行完毕之后同一目录下将生成两个新文件'ip-up'和'ip-down'
  # 把这两个文件copy到 /etc/ppp 目录, 并使用 `sudo chmod a+x ip-up ip-down`命令把它们设置为可执行
  # 设置完毕, 重新连接vpn. 测试步骤同上.

= Linux =
===openvpn===
  # 下载 chnroutes_ovpn_linux
  # 从终端进入下载目录, 执行`python chnroutes_ovpn_linux`, 执行完毕之后同一目录下将生成两个新文件'vpnup'和'vpndown'
  # 在终端里运行命令 `chmod a+x vpnup vpndown` 把这两个文件设置为可执行
  # 把这两个文件copy到openvpn的配置目录并修过openvpn配置文件, 在末尾加上两句:
    {{{
    up vpnup
    down vpndown
    }}}
  # 设置完毕, 重连openvpn.  测试方法同mac osx, 但需要使用 `ip route` 代替mac上的 `route` 命令
===pptp===
使用跟openvpn_linux相同的生成脚本, 区别是把生成的vpnup文件改名为 ip-pre-up, 并把ip-pre-up 拷贝到 /etc/ppp目录, vpndown 拷贝到 /etc/ppp/ip-down.d 目录. 测试步骤同上.

= Windows =
===openvpn===
由于windows上的route命令执行时间相当长, 所以不能直接在openvpn脚本里进行调用, 否则会导致超时错误. 使用步骤是下载chnroutes_ovpn_win, 然后在cmd里利用`python chnroutes_ovpn_win` 生成vpn路由批处理文件 vpnup.bat 和vpndown.bat. 在连接vpn之前手动执行vpnup.bat就可以设置这些路由, 这时不需要等待执行完毕就可以进行vpn拨号.
在断开vpn之后, 如果想删除这些路由, 可以执行vpndown.bat文件.

对于没有python的windows用户, 可以直接下载已经预生成的vpnup.bat文件. 因为ip范围改变频率不高, 所以也不会有什么影响.
===pptp===
同上, 由于windows上的pptp不支持拨号脚本, 所以也只能在进行拨号之前手动执行vpnup.bat文件以设置路由表.